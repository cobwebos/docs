---
title: 项目音响效果 Unreal 烘焙教程
titlesuffix: Azure Cognitive Services
description: 本文档介绍使用 Unreal 编辑器扩展提交音效烘培的过程。
services: cognitive-services
author: kegodin
manager: nitinme
ms.service: cognitive-services
ms.subservice: acoustics
ms.topic: tutorial
ms.date: 03/20/2019
ms.author: michem
ms.openlocfilehash: 48a1c4350b438761aa2e2d8c7e57a872c86ca292
ms.sourcegitcommit: c174d408a5522b58160e17a87d2b6ef4482a6694
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/18/2019
ms.locfileid: "59797169"
---
# <a name="project-acoustics-unreal-bake-tutorial"></a>项目音响效果 Unreal 烘焙教程
本文档介绍使用 Unreal 编辑器扩展提交音效烘培的过程。

制作过程包括 5 个步骤：

1. 创建或标记播放器导航网格
2. 标记音效几何体
3. 将音效材料属性分配给几何体
4. 预览探测放置
5. 制作

## <a name="open-the-project-acoustics-editor-mode"></a>打开项目音响效果编辑器模式

将项目音响效果插件包导入项目。 有关此操作的帮助，请参阅 [Unreal 集成](unreal-integration.md)主题。 该插件集成后，可通过单击新的音效模式图标来打开音效 UI。

![Unreal 编辑器音效模式选项的屏幕截图](media/acoustics-mode.png)

## <a name="tag-actors-for-acoustics"></a>标记音效的执行组件

对象选项卡是打开噪声模式时所显示的第一个选项卡。 使用此选项卡可在你所处的级别标记执行组件，这会向执行组件添加 AcousticsGeometry 或 AcousticsNavigation 标记。

在世界大纲中选择一个或多个对象，或使用“批量选择”部分帮助选择特定类别的所有对象。 选择了对象后，使用“标记”部分将所需标记应用于所选对象。

如果某个对象既不包含 **AcousticsGeometry** 标记，也不包含 **AcousticsNavigation** 标记，则在模拟中会将其忽略。 仅支持静态网格、导航网格和布局。 如果标记其他任何对象，会将其忽略。

### <a name="for-reference-the-objects-tab-parts"></a>供参考：“对象”选项卡部件

![Unreal 中“音效对象”选项卡的屏幕截图](media/unreal-objects-tab-details.png)

1. 选项卡选择按钮（已选择“对象”选项卡）。 使用这些按钮可从上到下演示进行音效烘培的各个步骤。
2. 有关使用此页面需要执行的操作的简短说明。
3. 可用于所处级别中的执行组件的选择器。
4. 单击“选择”会选择所处级别中与至少一个已选中执行组件类型相匹配的所有对象。
5. 单击“取消全选”会清除当前所选内容。 这与点击 Esc 键相同。
6. 使用这些单选按钮可选择是将几何体还是导航标记应用于所选执行组件。
7. 单击“标记”会将所选标记添加到当前所选的所有执行组件。
8. 单击“取消标记”会从当前所选的所有执行组件删除所选标记。
9. 单击“选择已标记”会清除当前所选内容，并选择具有当前所选标记的所有执行组件。
10. 这些统计信息显示使用每种标记类型标记的执行组件数。

### <a name="tag-acoustics-occlusion-and-reflection-geometry"></a>标记音效屏蔽和反射几何体

打开“音效”窗口的“对象”选项卡。 如果对象应屏蔽、反射或吸收声音，则将此对象标记为“音效几何体”。 音效几何体可包含地面、墙壁、屋顶、窗户和窗玻璃、地毯以及大型家具等物体。 你可对这些对象使用任意复杂度级别。 由于场景已在模拟前像素化处理，因此与简单化的对象相比，详细网格（例如带有很多小树叶的树木）的成本不会增加太多。

不要包含不得对音效造成影响的物体，例如不可见碰撞体网格。

烘培结果中修复了对象在（通过下面的“探测”选项卡）探测计算时的转换。 移动场景中任何标记的对象都需要重做探测计算并重做场景。

### <a name="create-or-tag-a-navigation-mesh"></a>创建或标记导航网格

导航网格用于放置模拟的探测点。 可以使用 Unreal 的[导航网格边界体](https://api.unrealengine.com/INT/Engine/AI/BehaviorTrees/QuickStart/2/index.html)，也可以指定自己的导航网格。 必须将至少一个对象标记为“音效导航”。 如果使用 Unreal 的导航网格，请确保先生成该网格。

### <a name="acoustics-volumes"></a>音效柱 ###

对于导航区域，可以使用**音效柱**做出进一步的高级自定义。 **音效柱**是可以添加到场景中的执行组件，用于选择要在导航网格中包含或忽略的区域。 该执行组件公开一个属性，该属性的值可为“包含”或“排除”。 “包含”柱确保仅考虑导航网格内部的区域，“排除”柱将这些区域标记为忽略。 始终是先应用“包含”柱，再应用“排除”柱。 请确保通过“对象”选项卡中的正常过程，将“音效柱”标记为“音效导航”。系统不会自动标记这些执行组件。

![Unreal 中“音效柱”属性的屏幕截图](media/unreal-acoustics-volume-properties.png)

“排除”柱主要用于在未应用探测来严格化资源的使用时进行精细控制。

![Unreal 中的“排除”音效柱的屏幕截图](media/unreal-acoustics-volume-exclude.png)

“包含”柱用于创建场景的人工部分，例如，将场景分解成多个音效区域。 例如，如果你有一个覆盖好几平方公里的大型场景，你想要在其中的两个兴趣区域中烘培音效。 在这种情况下，可以在该场景中绘制两个较大的“包含”柱，并逐个地为每个柱生成 ACE 文件。 然后，在游戏中，当玩家靠近每个图块时，你可以结合蓝图调用，使用触发器柱来加载相应的 ACE 文件。

**音效柱**只会限制导航，而不限制几何图形。 执行波形模拟时，“包含”**音效柱**中的每个探测仍会提取柱外部的全部所需几何图形。 因此，玩家从一个区段进入另一个区段不应会导致遮挡或其他音效出现任何不连续的情况。

## <a name="select-acoustic-materials"></a>选择音效材料

对象标记后，单击“材料”按钮可转到“材料”选项卡。此选项卡用于为所处级别中的每个材料指定材料属性。 标记任何执行组件之前，它会为空。

声学材料控制从每个表面反射回来的声音能量的大小。 默认音效材料具有与混凝土类似的吸收能力。 项目音响效果根据场景材料名称推荐材料。

房间中给定材料的混响时间与其吸收系数成反比，并且大多数材料的吸收系数值介于 0.01 到 0.20 之间。 如果材料的吸收系数高于此范围，则其吸收性很强。 例如，如果房间回音过大，请将墙壁、地板或天花板的声学材料更改为吸收率更高的某种材料。 音效材料分配适用于所有使用该场景材料的执行组件。

![此图显示混响时间与吸收系数的负相关性](media/reverb-time-graph.png)

### <a name="for-reference-parts-of-the-materials-tab"></a>供参考：“材料”选项卡的控件部件

![Unreal 中“音效对象”选项卡的屏幕截图](media/unreal-materials-tab-details.png)

1. “材料”选项卡按钮，用于打开此页面。
2. 有关使用此页面需要执行的操作的简短说明。
3. 所处级别中使用的材料的列表，取自标记为 AcousticsGeometry 的执行组件。 此时单击材料可选择场景中使用该材料的所有对象。
4. 显示已分配给场景材料的声学材料。 单击下拉列表，向其他声学材料重新分配场景材料。
5. 显示上一列中所选材料的噪音吸收系数。 值为零表示完美反射（无吸收），而值为 1 表示完美吸收（无反射）。 更改此值会将音效材料更新（步骤 4）为“自定义”。

如果对场景中的材料进行更改，则需要在“项目音效”插件中切换选项卡才能在“材料”选项卡中反映这些更改。

## <a name="calculate-and-review-listener-probe-locations"></a>计算并检查侦听器探测位置

分配材料后，切换到“探测”选项卡。

### <a name="for-reference-parts-of-the-probes-tab"></a>供参考：“探测”选项卡的控件部件

![Unreal 中“音效探测”选项卡的屏幕截图](media/unreal-probes-tab-details.png)

1. “探测”选项卡按钮，用于打开此页面
2. 有关需要使用此页面执行的操作的简短说明
3. 使用此页面可选择粗糙或精细分辨率。 粗糙分辨率的速度更快，但需要进行某种权衡。 请参阅下面的[烘培分辨率](bake-resolution.md)了解详细信息。
4. 使用此字段，选择应该放置声学数据文件的位置。 单击具有“...”的按钮以使用文件夹选取器。 要详细了解数据文件，请参阅下面的[数据文件](#Data-Files)。
5. 系统使用此处提供的前缀命名该场景的数据文件。 默认值为“[级别名称]_AcousticsData”。
6. 单击“计算”按钮可体素化场景并计算探测点位置。 此操作在计算机本地执行，并且必须在进行制作前完成。 计算完探测后，将禁用上述控件，此按钮会更改为显示“清除”。 单击“清除”按钮，清除计算并启用控件，以便可以使用新设置重新计算。

必须通过“探测”选项卡中提供的自动化过程中放置探测。


### <a name="what-the-calculate-button-calculates"></a>“计算”按钮计算的内容

“计算”按钮采用到目前为止提供的所有数据（几何体、导航、材料和粗糙/精细设置）并执行以下几个步骤：

1. 它采用场景网格中的几何体并计算体素体。 体素体是一个三维体，包含整个场景，并由较小的立方“体素”组成。 体素的大小由模拟频率决定，而模拟频率通过“模拟分辨率”设置进行设定。 每个体素都被标记为“露天”或包含场景几何体。 如果体素包含几何体，则使用分配给该几何体的材料的吸收系数标记该体素。
2. 然后它使用导航数据计算播放器可能到达的在声学上有趣的位置。 它会尝试查找少量包括较小区域的这些位置，例如门廊和走廊，然后到房间，再到开放的空间。 小型场景通常包含不到 100 个位置，而大型场景可能多达 1000 个位置。
3. 对于它计算的每个最终侦听器位置，它将确定多个参数，例如空间“开阔”程度如何，所在房间的大小等等。
4. 这些计算的结果存储在指定位置的文件中（请参阅下方的[数据文件](#Data-Files)）

这些计算可能需要几分钟，具体取决于场景的大小和计算机的速度。

这些计算完成后，便可以预览体素数据和探测点的位置，以帮助确保制作结果良好。 在预览中一般可以快速显示错误的导航网格或缺失/额外的几何体等内容，以便可以进行纠正。


## <a name="debug-display"></a>调试显示

完成探测计算之后，新执行组件会出现在世界大纲中，名为 AcousticsDebugRenderer。 选中“呈现探测”和“呈现体素”复选框会在编辑器视区内启用调试显示。

![显示 Unreal 编辑器中音效调试呈现器执行组件的屏幕截图](media/acoustics-debug-renderer.png)

如果在你所处级别上未看到覆盖任何体素或探测，请确保在视区中启用了实时呈现。

![Unreal 中实时呈现选项的屏幕截图](media/unreal-real-time-rendering.png)

### <a name="voxels"></a>体素

体素以参与几何体周围的绿色立方体的形式显示在场景窗口中。 不显示仅包含空气的体素。 整个场景周围有一个大型的绿色框，表示将用于模拟的完整体素体。
在场景中移动并验证音效屏蔽几何体是否具有体素。 此外，检查非音效对象（如屏蔽网格）是否未体素化。 场景照相机必须在对象 5 米范围内，以便体素显示。

如果比较所创建的体素在低分辨率和高分辨率下的效果，你将看到低分辨率的体素是高分辨率的两倍大。

![Unreal 编辑器中音效体素预览的屏幕截图](media/unreal-voxel-preview.png)

### <a name="probe-points"></a>探测点

探测点是可能的播放器（侦听器）位置的代名词。 进行烘培时，模拟会计算将所有可能的源位置连接到每个探测点的音效。 在运行时，侦听器位置会在附近的探测点间进行内插。

请务必检查在期望播放机在场景中移动的任何位置处是否都存在探测点。 探测点由项目音响效果引擎放置在导航网格上，无法进行移动或编辑，因此请通过检查探测点来确保导航网格涵盖所有可能的播放机位置。

![Unreal 中音效探测预览的屏幕截图](media/unreal-probes-preview.png)

请参阅[烘培分辨率](bake-resolution.md)了解有关粗糙分辨率与精细分辨率的更多详细信息。

## <a name="bake-your-level-using-azure-batch"></a>使用 Azure Batch 烘焙级别

可借助 Azure Batch 服务使用云端计算群集来烘焙场景。 项目音响效果 Unreal 插件会直接连接到 Azure Batch，为每个烘焙实例化、管理和关闭一个 Azure Batch 群集。 在“烘焙”选项卡上，输入你的 Azure 凭据，选择群集计算机类型和大小，然后单击“烘焙”。

### <a name="for-reference-parts-of-the-bake-tab"></a>供参考：“制作”选项卡的控件部件

![Unreal 中“音效烘焙”选项卡的屏幕截图](media/unreal-bake-tab-details.png)

1. “制作”选项卡，按钮用于打开此页面。
2. 有关要在此页上所执行操作的简短说明。
3. 创建 Azure 帐户后，用于输入 Azure 凭据的字段。 有关详细信息，请参阅[创建 Azure Batch 帐户](create-azure-account.md)。
4. 启动 Azure 门户以管理你的订阅，监视使用情况和查看计费信息等。 
5. Azure Batch 计算用于计算的节点类型。 节点类型必须受 Azure 数据中心位置支持。 如果不确定，则保留 Standard_F8s_v2。
6. 要用于此计算的节点数。 此处输入的数字将影响完成制作的时间，并受 Azure Batch 核心分配限制。 默认分配仅允许使用两个 8 核节点或一个 16 核节点，但可以进行扩展。 有关核心分配约束的详细信息，请参阅[创建 Azure Batch 帐户](create-azure-account.md)。
7. 选择此复选框可将你的计算机池配置为使用[低优先级节点](https://docs.microsoft.com/azure/batch/batch-low-pri-vms)。 低优先级计算节点的成本较低，但它们可能并非一直可用或可能随时被抢占。
8. 作业在云中运行预计需要的运行时间。 这不包括节点启动时间。 作业开始运行后，这是返回结果前需要等待的时间。 请注意，这只是估计值。
9. 运行模拟所需的总计算时间。 这是 Azure 中将使用的总的节点计算时间。 有关如何使用该值的详细信息，请参阅[估计制作成本](#Estimating-bake-cost)。
10. 单击“制作”按钮，将制作提交到云。 运行作业时，这将改为显示“取消作业”。 如果此选项卡上存在任何错误，或者如果“探测”选项卡上的工作流尚未完成，则会禁用此按钮。
11. 场景的探测计数在“探测”选项卡上计算得出。探测数决定需要在云中运行的模拟次数。 不能指定多于探测数的节点数。
12. 此消息会告知作业的当前状态，或是在此选项卡中存在任何错误时告知这些错误是什么。

随时可在 [Azure 门户](https://portal.azure.com)获取关于有效作业、计算池和存储的完整信息。

作业运行时，“制作”按钮将变为“取消作业”。 使用此按钮可取消正在进行中的作业。 取消作业无法撤消，不会显示任何结果，但用户仍需要为取消之前使用的任何 Azure 计算时间付费。

开始烘培后，即可以关闭 Unreal。 云制作可能需要数个小时，具体取决于项目、节点类型和节点数。 重新加载该项目并打开“音效”窗口时，制作作业状态将更新。 如果作业已完成，将下载输出文件。

Azure 凭据安全地存储在本地计算机上，并与 Unreal 项目相关联。 它们仅用于建立与 Azure 的安全连接。

### <a name="Estimating-bake-cost"></a> 估计 Azure 制作成本

要估计给定制作的成本，请采用“估计的计算成本”中显示的值（一段持续时间），再乘以所选 VM 节点类型的每小时费用（当地货币）。 结果不包括节点启动和运行所需的节点时间。 例如，如果为节点类型选择 Standard_F8s_v2，其费用为 $0.40/小时，而“估计的计算成本”为 3 小时 57 分钟，则运行作业的估计成本为 $0.40 * ~4 小时 = ~$1.60。 实际成本很可能略高，因为开始使用节点时会产生的额外时间。 在 [Azure Batch 定价](https://azure.microsoft.com/pricing/details/virtual-machines/linux)页可找到每小时的节点费用（对类别选择“优化计算”或“高性能计算”）。

### <a name="reviewing-the-bake-results"></a>查看制作结果

制作完成后，通过运行运行时插件，检查体素和探测点是否位于预期的位置。

## <a name="Data-Files"></a>数据文件

此插件在不同位置创建了 4 个数据文件。 其中只有一个文件是运行时所需的，会放置在项目的 Content/Acoustics 文件夹中（会自动添加到项目的打包路径）。 其他三个文件处于 Acoustics Data 文件夹中，不会进行打包。

* **[项目]/Config/ProjectAcoustics.cfg**：此文件存储你在音效模式 UI 的字段中输入的数据。 不能更改此文件的位置和名称。 此文件中存储影响制作的其他值，但它们针对高级用户且不得更改。
* **[项目]/Content/Acoustics/[级别名称]\_AcousticsData.ace**：此文件创建于烘培模拟过程中，包含运行时所用的查找数据，以呈现场景的音效。 使用“探测”选项卡上的字段可更改此文件的位置和名称。
* **[项目]/Plugins/ProjectAcoustics/AcousticsData/[级别名称]\_AcousticsData.vox**：此文件存储体素化声学几何体和材料属性。 使用“探测”选项卡上的“计算”按钮进行计算。使用“探测”选项卡上的字段可更改此文件的位置和名称。
* **[项目]/Plugins/ProjectAcoustics/AcousticsData/[级别名称]\_AcousticsData\_config.xml**：此文件存储使用“探测”选项卡上的“计算”按钮计算的参数。使用“探测”选项卡上的字段可更改此文件的位置和名称。

请注意，不要删除从 Azure 下载的 *.ace 文件。 除重新制作场景外，此文件是无法恢复的。

## <a name="next-steps"></a>后续步骤
* 了解 [Unreal 设计控件](unreal-workflow.md)
* 了解[项目音响效果设计概念](design-process.md)

