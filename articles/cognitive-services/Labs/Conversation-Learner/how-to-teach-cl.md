---
title: 如何训练对话学习器 - Microsoft 认知服务 | Microsoft Docs
titleSuffix: Azure
description: 了解如何训练对话学习器。
services: cognitive-services
author: v-jaswel
manager: nolachar
ms.service: cognitive-services
ms.component: conversation-learner
ms.topic: article
ms.date: 04/30/2018
ms.author: v-jaswel
ms.openlocfilehash: 639fea64fc8eeb2c1f6e6240c4eb26efc68febbd
ms.sourcegitcommit: 95d9a6acf29405a533db943b1688612980374272
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/23/2018
ms.locfileid: "35366257"
---
# <a name="how-to-teach-with-conversation-learner"></a>如何训练对话学习器 

本文档介绍对话学习器可感知的信号，及其学习方式。  

训练可分为两个不同步骤：实体提取和操作选择。

## <a name="entity-extraction"></a>实体提取

事实上，对话学习器使用 [LUIS](https://www.luis.ai) 进行实体提取。  如果用户熟悉 LUIS，则相关体验同样适用于对话学习器中的实体提取。

实体提取模型可识别用户话语中的内容和上下文。  例如，如果一句话语（如“西雅图天气如何”）中的“西雅图”一词被标记为城市，那么即使话语完全不同，实体提取也能够将另一句话语（如“西雅图的人口”）中的相同内容（“西雅图”）识别为城市。  相反，如果将“安排与弗朗西斯会面”中的“弗朗西斯”识别为姓名，则此后可识别类似上下文（如“安排与罗宾会面”）中之前未出现过的新姓名。  机器学习基于训练例子推断何时识别内容、上下文或同时识别两者。

目前，实体提取只可识别当前话语的内容。  实体提取与操作选择（下方介绍）不同，它无法识别对话历史，例如之前批次的系统会话和用户会话或之前识别的实体。  因此，实体提取行为会在所有话语中“共享”。  例如，如果在一个用户话语中将“我想要 Apple”中的“Apple”一词标记为“水果”实体，则实体提取模型将认为，在该话语（“我想要 Apple”）中，“Apple”始终应 标记为“水果”。

如果实体提取的行为与预期不一致，可采取以下修正措施：

- 首先应尝试添加更多训练示例，尤其是能显示典型实体上下文（前后文）或例外情况的示例
- 在适用的情况下，可考虑向操作添加“预期实体”属性。  可参阅“预期实体”教程，了解详细信息。
- 虽然可向 `EntityExtractionCallback` 添加手动处理，从而使用代码提取实体，但这并非首选方法，因为随着系统的成熟，采用此方法，无法从改进后的机器学习中受益。

## <a name="action-selection"></a>操作选择

操作选择使用递归神经网络，该网络将全部对话历史用作输入。  因此，操作选择是一个有状态的过程，可识别之前的用户话语、实体值和系统话语。  

某些信号会自然成为学习过程的首选信号。  换言之，如果存在对话学习器“会首先选择的”信号，对话学习器会使用该信号来解释操作选择决定；如果不存在，对话学习器会使用“次优”信号。

下表显示了对话学习器中的所有信号，以及操作选择会使用哪些信号。  请注意，不考虑用户话语中的词语顺序。

信号 | 优先级（1=首选） | 说明
--- | --- | --- 
上一批次中的系统操作 | 1 | 
当前批次中出现的实体 | 1 | 
是否为首批 | 1 |
当前用户话语中完全匹配的词语 | 2 | 
当前用户话语中含义类似的词语 | 3 | 
上一批次之前的系统操作 | 4 |
当前批次之前的批次中出现的实体 | 4 | 
当前批次之前的用户话语 | 5 | 

请注意，操作选择确实会采用系统操作的内容（文本、卡内容或 API 名称或行为），但仅采用系统操作的标识。  因此，更改操作的内容不会改变操作选择模型的行为。

此外，请注意不会使用实体的内容/值，只会考虑实体存在与否。

如果操作选择的行为与预期不一致，可采取以下修正措施：

- 添加更多训练对话，尤其是可展示操作选择应注意的信号的对话。  例如，如果操作选择应优先考虑一个信号，则应提供展示了处于相同状态的该首选信号的示例，其他信号以此类推。  某些序列可能需要采用更多训练对话来进行学习。
- 向操作定义添加“必需”和“取消资格”实体。  这会对操作的适用情况进行限制，可用于表达业务规则和一些常见模式。 

## <a name="updates-to-models"></a>模型更新

只要在 UI 中添加或编辑实体、操作或训练对话，那么就会生成重新训练实体提取模型和操作选择模型的请求。  此请求针对队列发出，而重新训练则在异步情况下完成。  如果出现可用的新模型时，该模型将从此时点开始用于实体提取和操作选择。  这种重新训练过程通常需要大约 5 秒钟，但如果模型较为复杂，或训练服务负载较高，则可能需要更长时间。

由于训练是异步完成的，因此所做编辑可能不会立即生效。  如果更改后，实体提取或操作选择未在 5-10 秒内按预期运行，则可能是因为此原因。

## <a name="next-steps"></a>后续步骤

> [!div class="nextstepaction"]
> [默认值和边界](./cl-values-and-boundaries.md)
