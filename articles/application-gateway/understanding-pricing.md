---
title: 了解 Azure 应用程序网关定价
description: 本文介绍适用于 v1 到 v2 Sku 的 Azure 应用程序网关和 Web 应用程序防火墙的计费过程
services: application-gateway
author: azhar2005
ms.service: application-gateway
ms.topic: conceptual
ms.custom: references_regions
ms.date: 09/01/2020
ms.author: azhussai
ms.openlocfilehash: 1d88379726cfb6c4218c38b9ccc87005609a9aba
ms.sourcegitcommit: 4a7a4af09f881f38fcb4875d89881e4b808b369b
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/04/2020
ms.locfileid: "89460739"
---
# <a name="understanding-pricing-for-azure-application-gateway-and-web-application-firewall"></a>了解 Azure 应用程序网关和 Web 应用程序防火墙的定价

>[!NOTE]
>本文中所示的价格是示例，仅用于说明目的。 如要了解你所在的区域，请参阅 [定价页](https://azure.microsoft.com/pricing/details/application-gateway/)。

Azure 应用程序网关是第7层负载均衡解决方案，可在 Azure 上实现可扩展、高度可用且安全的 web 应用程序交付。

应用程序网关不会产生前期成本或终止成本。
将仅对预配的资源计费，并根据实际的每小时消耗情况进行使用。 与应用程序网关关联的成本划分为两个组件：固定成本和可变成本。 每个组件内的实际成本会因使用的 SKU 而异。

本文介绍与每个 SKU 相关的成本，建议用户使用本文档来规划和管理 Azure 应用程序网关相关的成本。

## <a name="v1-skus"></a>V1 Sku

标准应用程序网关和 WAF V1 Sku 按以下方式计费：

* 固定成本

    基于特定类型的应用程序网关/WAF 预配和运行处理请求时的成本。
    固定成本组件考虑以下因素：
    * 层标准应用程序网关或 WAF
    * 大小-小型、中型 & 大型
    * 实例计数-要部署的实例数

    对于 N 个实例，关联的成本将为 N * (标准 & WAF) & 大小 (小、中 & 大) 组合的特定层的一个实例的成本。

* 可变成本

    基于应用程序网关/WAF 处理的数据量的成本。 应用程序网关处理的请求和响应字节都将视为计费。

总成本 = 固定成本 + 可变成本

### <a name="standard-application-gateway"></a>标准应用程序网关

固定成本 & 可变成本将根据应用程序网关类型进行计算。
下表显示了基于美国东部定价快照的示例价格，仅用于说明目的。

#### <a name="fixed-cost-east-us-region-pricing"></a>固定成本 (美国东部地区定价) 

|              应用程序网关类型             |  成本 ($ 美元/小时)   |
| ------------------------------------------------- | ---------------|
|                     小型                         |    $0.025      |
|                     中型                        |    $0.07       |
|                     大型                         |    $0.32       |

每月价格评估基于每个月730小时的使用量。

#### <a name="variable-cost-east-us-region-pricing"></a>可变成本 (美国东部地区定价) 

|              处理的数据             |  Small ($/GB)   |  中型 ($/GB)  |  大型 ($/GB)  |
| --------------------------------------- | -------------- | -------------- | ------------- |
| 前 10 TB/月                       |     0\.008 美元     |      免费      |     免费      |
| 未来 30 TB (10 – 40 TB) /月             |     0\.008 美元     |     $0.007     |     免费      |
| 超过 40 TB/月                        |     0\.008 美元     |     $0.007     |     $0.0035   |

如要了解你所在的区域，请参阅 [定价页](https://azure.microsoft.com/pricing/details/application-gateway/)。

### <a name="waf-v1"></a>WAF V1

固定成本 & 会根据预配的应用程序网关类型计算可变成本。

下表显示了基于美国东部价格的快照的示例价格，仅用于说明目的。

#### <a name="fixed-cost-east-us-region-pricing"></a>固定成本 (美国东部地区定价) 

|              应用程序网关类型             |  成本 ($ 美元/小时)   |
| ------------------------------------------------- | ---------------|
|                     小型                         |       不可用       |
|                     中型                        |     $0.126     |
|                     大型                         |     $0.448     |

每月价格评估基于每个月730小时的使用量。

#### <a name="variable-cost-east-us-region-pricing"></a>可变成本 (美国东部地区定价) 

|              处理的数据             |  Small ($/GB)   |  中型 ($/GB)  |  大型 ($/GB)  |
| --------------------------------------- | -------------- | -------------- | ------------- |
| 前 10 TB/月                       |     0\.008 美元     |      免费      |     免费      |
| 未来 30 TB (10 – 40 TB) /月             |     0\.008 美元     |     $0.007     |     免费      |
| 超过 40 TB/月                        |     0\.008 美元     |     $0.007     |     $0.0035   |

如要了解你所在的区域，请参阅 [定价页](https://azure.microsoft.com/pricing/details/application-gateway/)。

> [!NOTE]
> 出站数据传输-通过应用程序网关从 Azure 数据中心传出的数据将按照标准 [数据传输费率](https://azure.microsoft.com/pricing/details/bandwidth/)进行收费。

### <a name="example-1-a--standard-application-gateway-with-1-instance-count"></a>示例 1 (具有1个实例计数的) 标准应用程序网关

假设你预配了包含1个实例的中等类型标准应用程序网关，并且每月会处理 500 GB。 使用上述定价的应用程序网关成本按如下方式计算：

固定价格 = $0.07 * 730 (小时) = $51.1 每月价格评估基于每月730小时的使用量。

可变成本 = 免费 (中等级别对于每月处理的前 10 TB 没有成本) 总费用 = $51.1 + 0 = $51。1 

> [!NOTE]
> 要支持高可用性方案，需要为 V1 Sku 设置最少2个实例。 请参阅 [应用程序网关的 SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/v1_2/)

### <a name="example-1-b--standard-application-gateway-with--1-instance-count"></a>示例 1 (b) –具有 > 1 实例计数的标准应用程序网关

假设你预配了中等类型的标准应用程序网关，其中包含五个实例，每月处理 500 GB。 使用上述定价的应用程序网关成本按如下方式计算：

固定价格 = 5 (实例计数) * $0.07 * 730 (小时) = $255.5 每月价格评估基于每月730小时的使用量。

可变成本 = 免费 (中等级别对于每月处理的前 10 TB 没有成本) 总费用 = $255.5 + 0 = $255。5 

### <a name="example-2--waf-application-gateway"></a>示例2– WAF 应用程序网关

假设你预配了小型类型标准应用程序网关和大型类型 WAF 应用程序网关（在该月的前15天）。 小型应用程序网关在其处于活动状态的持续时间内处理 15 TB，大型 WAF 应用程序网关在其处于活动状态的持续时间内处理 100 TB。 使用上述定价的应用程序网关成本按如下方式计算： 

###### <a name="small-instance-standard-application-gateway"></a>小型实例标准应用程序网关

24小时 * 15 天 = 360 小时

固定价格 = $0.025 * 360 (小时) = $9

可变成本 = 10 * 1000 * $ 0.008/GB + 5 * 1000 * $ 0.008/GB = $120

总费用 = $9 + $120 = $129

###### <a name="large-instance-waf-application-gateway"></a>大型实例 WAF 应用程序网关
24小时 * 15 天 = 360 小时

固定价格 = $0.448 * 360 (小时) = $161.28

可变成本 = 60 * 1000 * $ 0.0035/GB = $210 (大型级别对于每月处理的第一个 40 TB 没有成本) 

总费用 = $161.28 + $210 = $371.28

## <a name="v2-skus"></a>V2 Sku  

默认情况下，应用程序网关 V2 和 WAF V2 Sku 支持自动缩放，并保证高可用性。

### <a name="key-terms"></a>主要术语

##### <a name="capacity-unit"></a>容量单位 
容量单位是跨多个参数对应用程序网关的容量利用率的度量。

单个容量单位由以下参数组成：
* 2500永久性连接
* 2.22-Mbps 吞吐量
* 1个计算单元

如果超过了其中的任何一个参数，则需要另一个 n 容量单位 () ，即使其他两个参数不超过此单个容量单元的限制。
在上述三个中具有最高利用率的参数将在内部用于计算容量单位，这反过来又会产生费用。

##### <a name="compute-unit"></a>计算单元
计算单元是使用计算容量的度量值。 影响计算单元消耗的因素包括 TLS 连接数/秒、URL 重写计算和 WAF 规则处理。 计算单元可处理的请求数取决于各种条件，例如 TLS 证书密钥大小、密钥交换算法、标头重写以及 WAF 传入请求大小的情况。

计算单位指导：
* Standard_v2 - 每个计算单位每秒可以使用 RSA 2048 位密钥 TLS 证书处理大约 50 个连接。

* WAF_v2 - 如果流量混合率为 70-30%，且 70% 的请求小于 2 KB GET/POST，剩余请求的计算量更高，则每个计算单位可支持每秒大约 10 个并发请求。 目前，WAF 性能不受响应大小的影响。

##### <a name="instance-count"></a>实例计数 
为应用程序网关 V2 Sku 预配资源的方式是根据实例计数来定义的。 每个实例都保证最少10个容量单位的处理能力。 对于不同的流量模式，同一实例可能支持超过10个容量单位，具体取决于容量单元参数。

为自动缩放设置的手动定义的缩放和限制 (最小值或最大) 根据实例计数设置。 自动缩放配置中的实例计数和最小实例计数的手动设置规模将保留10个容量单位/实例。 只要应用程序网关处于活动状态，无论实际消耗的资源如何，都将对这些保留 Cu 进行计费。 如果实际消耗超过10个容量单位/实例阈值，则附加容量单位将按变量组件计费。

V2 Sku 按使用情况计费，并由两部分组成：

* 固定成本

    基于应用程序网关 V2/WAF V2 的预配时间和可用于处理请求的时间收费。 这可确保高可用性，即使在自动缩放的过程中，将 "最小实例计数" 中指定为0，也会保留0个实例。 
    
    固定成本还包括与附加到应用程序网关的公共 IP 相关的成本。

    在任何时间点运行的实例数不会被视为 V2 Sku 的固定成本的一个因素。 无论在同一 Azure 区域中运行多少个实例，运行 Standard_V2 (或 WAF_V2) 的固定成本都是相同的。

* 容量单位成本 

    根据处理传入请求所需的容量单位数，或根据需要使用的容量单位数量收费。  基于消耗的成本按小时计算。

总成本 = 固定成本 + 容量单位成本

> [!NOTE]
> 部分小时按整小时计费。

下表显示了基于美国东部价格的快照的示例价格，仅用于说明目的。

#### <a name="fixed-costs-east-us-region-pricing"></a>固定成本 (美国东部地区定价) 

|              V2 SKU             |  成本 ($ 美元/小时)   |
| ------------------------------- | ---------------|
|            Standard_V2          |     $0.246     |
|              WAF_V2             |     $0.443     |

每月价格评估基于每个月730小时的使用量。

#### <a name="variable-costs-east-us-region-pricing"></a>可变成本 (美国东部地区定价) 

|        容量单位         |  Standard_V2 ($ 美元/小时)   |  WAF_V2 ($ 美元/小时)  |
| ---------------------------- | -------------------- | -------------- |
|             1 CU             |        0\.008 美元        |     $0.0144    |

如要了解你所在的区域，请参阅 [定价页](https://azure.microsoft.com/pricing/details/application-gateway/)。

> [!NOTE]
> 出站数据传输-通过应用程序网关从 Azure 数据中心传出的数据将按照标准 [数据传输费率](https://azure.microsoft.com/pricing/details/bandwidth/)进行收费。

### <a name="example-1-a--manual-scaling"></a>示例 1 () –手动缩放 
假设你预配了一个 Standard_V2 应用程序网关，并将手动缩放设置为整个月8个实例。 在此期间，它会平均收到88.8 到 Mbps 的数据传输。

使用上述定价的应用程序网关成本按如下方式计算：

1 CU 可以处理2.22 到 Mbps 的吞吐量。

需要 Cu 来处理 88.8 Mbps = 88.8/2.22 = 40 Cu 

预设置的 Cu = 8 (实例计数) * 10 = 80 

由于 80 (保留容量) > 40 (所需容量) ，无需额外的 Cu。 

固定价格 = $0.246 * 730 (小时) = $179.58

可变成本 = $0.008 * 8 (实例单位) * 10 (容量单位) * 730 (小时) = $467。2

总费用 = $179.58 + $467.2 = $646.78

![手动缩放1的关系图。](./media/pricing/manual-scale-1.png)

### <a name="example-1-b--manual-scaling-with-traffic-going-beyond-provisioned-capacity"></a>示例 1 (b) –对超出预配容量的流量进行手动缩放

假设你预配了一个 Standard_V2 应用程序网关，并在整个月将手动缩放设置为3个实例。 在此期间，它会平均收到88.8 到 Mbps 的数据传输。

使用上述定价的应用程序网关成本按如下方式计算：

1 CU 可以处理 2.22 Mbps 吞吐量。

处理 88.8 Mbps = 88.8/2.22 = 40 所需的 Cu 

预设置的 Cu = 3 (实例计数) * 10 = 30 

由于 40 (所需容量) > 30 (保留容量) ，需要额外的 Cu。
使用的额外 Cu 数取决于每个实例可用的可用容量。

如果处理容量等效于10个附加 Cu 的容量可在3个预订实例内使用。

固定价格 = $0.246 * 730 (小时) = $179.58

可变成本 = $0.008 * ( 3 (实例单位) * 10 (容量单位) + 5 (额外容量单位) ) * 730 (小时) = $204。4

总费用 = $179.58 + $204.4 = $383.98

![手动缩放2的关系图。](./media/pricing/manual-scale-2.png)

> [!NOTE]
> 在手动缩放时，超过保留实例的最大处理容量的任何附加请求可能会影响应用程序的可用性。 在高负载情况下，根据传入请求的配置和类型，保留实例可能能够提供超过10个容量单位的处理能力。 但建议根据流量要求预配实例数。

### <a name="example-2--waf_v2-instance-with-autoscaling"></a>示例2–带有自动缩放功能 WAF_V2 实例

假设已预配启用了自动缩放的 WAF_V2，并将整个月份的最小实例计数设置为6。 请求加载已导致 WAF 实例向外扩展并使用65容量单位 (从5个容量单位向外扩展，而60单位已保留) 整月。
使用上述定价的应用程序网关成本按如下方式计算：

每月价格评估基于每个月730小时的使用量。

固定价格 = $0.443 * 730 (小时) = $323.39

可变成本 = $0.0144 * 65 (容量单位) * 730 (小时) = $683.28

总费用 = $323.39 + $683.28 = $1006.67

![自动缩放2的关系图。](./media/pricing/auto-scale-1.png)

> [!NOTE]
> 为应用程序网关观察到的实际流量不太可能具有这种持续的流量模式，应用程序网关上的观察负载会根据实际用量波动。

### <a name="example-3-a--waf_v2-instance-with-autoscaling-and-0-min-scale-config"></a>示例 3 (具有自动缩放和0分钟缩放配置的) WAF_V2 实例

假设已预配启用了自动缩放的 WAF_V2，并将整个月份的最小实例计数设置为0。 WAF 上的请求负载最小，但在整个月内每小时持续出现一次。 负载低于单个容量单位的容量。
使用上述定价的应用程序网关成本按如下方式计算：

每月价格评估基于每个月730小时的使用量。

固定价格 = $0.443 * 730 (小时) = $323.39

可变成本 = $0.0144 * 1 (容量单位) * 730 (小时) = $10.512

总费用 = $323.39 + $10.512 = $333.902

### <a name="example-3-b--waf_v2-instance-with-autoscaling-with-0-min-instance-count"></a>示例 3 (b) –具有自动缩放的 WAF_V2 实例，最小实例计数为0

假设已预配启用了自动缩放的 WAF_V2，并将整个月份的最小实例计数设置为0。 不过，每月有0个流量定向到 WAF 实例。
使用上述定价的应用程序网关成本按如下方式计算：

固定价格 = $0.443 * 730 (小时) = $323.39

可变成本 = $0.0144 * 0 (容量单位) * 730 (小时) = $0

总费用 = $323.39 + $0 = $323.39

### <a name="example-3-c--waf_v2-instance-with-manual-scaling-set-to-1-instance"></a>示例 3 (C) – WAF_V2 实例，手动缩放设置为1实例

假设已设置了一个 WAF_V2，并将其设置为在整个月可接受的最小值为1的实例进行手动缩放。 不过，每月有0个流量定向到 WAF。
使用上述定价的应用程序网关成本按如下方式计算：

每月价格评估基于每个月730小时的使用量。

固定价格 = $0.443 * 730 (小时) = $323.39

可变成本 = $0.0144 * 1 (实例计数) * 10 (容量单位) * 730 (小时) = $105.12

总费用 = $323.39 + $105.12 = $428.51

### <a name="example-4--waf_v2-with-autoscaling-capacity-unit-calculations"></a>示例 4-通过自动缩放、容量单元计算 WAF_V2

假设已预配启用了自动缩放的 WAF_V2，并将整个月份的最小实例计数设置为0。 在此期间，它每秒接收25个新的 TLS 连接，平均为 8.88-Mbps 的数据传输。
使用上述定价的应用程序网关成本按如下方式计算：

每月价格评估基于每个月730小时的使用量。

固定价格 = $0.443 * 730 (小时) = $323.39

可变成本 = $0.0144 * 730 (小时) * {Max (25/50，8.88/2.22) } = $23.36 (处理 8.88 Mbps 所需的容量单元) 

总费用 = $323.39 + $23.36 = $346.75

### <a name="example-5-a--standard_v2-with-autoscaling-time-based-calculations"></a>示例 5 (了) -Standard_V2 与自动缩放、基于时间的计算

假设已预配启用了自动缩放的 standard_V2，并将最小实例计数设置为0，并且此应用程序网关处于活动状态2小时。
在第一个小时内，它将接收可以由10个容量单位处理的流量，并在第二个小时内接收流量，要求20个容量单位来处理负载。
使用上述定价的应用程序网关成本按如下方式计算：

固定价格 = $0.246 * 2 (小时) = $0.492

可变成本 = $0.008 * 10 (容量单位) * 1 (小时) + $0.008 * 20 (容量单位) * 1 (小时) = $0.24

总费用 = $0.492 + $0.24 = $0.732


## <a name="monitoring-billed-usage"></a>监视计费使用情况

可以在 " **监视** " 部分下的 "应用程序网关指标" 部分中查看不同参数 (计算单元、吞吐量 & 永久性连接) 的消耗量，以及要使用的容量单位。

![度量值部分的关系图。](./media/pricing/metrics-1.png)

### <a name="useful-metrics-for-cost-estimation"></a>用于成本估算的有用指标

* 当前容量单位

    用于在三个参数之间对流量进行负载平衡的容量单元的计数-当前连接、吞吐量和计算单元

* 固定的可计费容量单位

    在应用程序网关配置中，每个实例 (一个实例转换为10个容量单位) ，根据 "最小实例计数" 设置保持预配的容量单元的最小数目。

* 估计的计费容量单位

    估计的计费容量单位表示估计账单费用时所使用的容量单位的数目。 该值的计算取决于“当前容量单位”（对流量进行负载均衡所需的容量单位）和“固定的可计费容量单位”（始终预配的最小容量单位）这两项中哪个项的值更大。

还可以使用更多指标，例如吞吐量、当前连接和计算单元来了解瓶颈，并估计所需的容量单位数。 有关详细信息，请参阅 [应用程序网关指标](application-gateway-metrics.md)

#### <a name="example---estimating-capacity-units-being-utilized"></a>示例-估计使用的容量单位

**观察到的指标：**

* 计算单位 = 17.38
* 吞吐量 = 1.37 M Bytes/sec-10.96 Mbps
* 当前连接数 = 123.08 k
* 计算容量单位 = 最大 (17.38、10.96/2.22、123.08 k/2500) = 49.232

观察到的容量单位（指标 = 49.23）

## <a name="next-steps"></a>后续步骤

请参阅以下文章，详细了解 Azure 应用程序网关中的定价如何工作：

* [Azure 应用程序网关定价页](https://azure.microsoft.com/pricing/details/application-gateway/)
* [Azure 应用程序网关定价计算器](https://azure.microsoft.com/en-us/pricing/calculator/?service=application-gateway)
