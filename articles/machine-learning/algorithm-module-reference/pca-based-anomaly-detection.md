---
title: 基于 PCA 的异常检测：模块引用
titleSuffix: Azure Machine Learning
description: 了解如何使用基于 PCA 的异常情况检测模块基于主体组件分析（PCA）创建异常检测模型。
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: likebupt
ms.author: keli19
ms.date: 02/22/2020
ms.openlocfilehash: f126eb347d11d3203ad3b97abe3606738e67c33c
ms.sourcegitcommit: 3c925b84b5144f3be0a9cd3256d0886df9fa9dc0
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/28/2020
ms.locfileid: "77925834"
---
# <a name="pca-based-anomaly-detection"></a>基于 PCA 的异常检测

本文介绍如何在 Azure 机器学习设计器（预览版）中使用**基于 PCA 的异常情况检测**模块，根据主体组件分析（PCA）创建异常情况检测模型。

此模块可帮助你在以下情况下构建模型：在这种情况下，可以轻松地从一个类获取定型数据（如有效事务），但很难获取足够的目标异常示例。 

例如，若要检测欺诈性交易，通常不会有足够的欺诈性示例，而是有很多关于良好交易的示例。 **基于 PCA 的异常情况检测**模块通过分析可用功能来确定什么是 "正常" 类，并应用距离指标来识别表示异常的事例，从而解决了此问题。 这使您可以使用现有的不均衡数据来训练模型。

## <a name="more-about-principal-component-analysis"></a>详细了解主成分分析

*主体组件分析*（通常缩写为 PCA）是机器学习中建立的一项技术。 PCA 常用于探索性数据分析，因为它可以显示数据的内部结构并解释数据差异。

PCA 通过分析包含多个变量的数据工作。 它将查找变量间的相关性，并确定最能捕获结果差异的值的组合。 这些组合的功能值用于创建一个更精简的功能空间（称为*主体组件*）。

对于异常情况检测，会分析每个新输入，异常检测算法会在本征向量上计算其投影，同时还会计算规范化的重建错误。 规范化错误用作异常分数。 错误级别越高，实例越异常。

有关 PCA 如何工作的详细信息以及异常检测的实现，请参阅以下文章：

- [用于主体组件分析的随机算法](https://arxiv.org/abs/0809.2274)。 作者 Rokhlin、Szlan 和 Tygert

- [查找具有随机性的结构：用于构造近似矩阵分解](http://users.cms.caltech.edu/~jtropp/papers/HMT11-Finding-Structure-SIREV.pdf)（PDF 下载）的概率算法。 作者 Halko、Martinsson 和 Tropp。

## <a name="how-to-configure-pca-anomaly-detection"></a>如何配置 PCA 异常检测

1. 在设计器中，将**基于 PCA 的异常情况检测**模块添加到管道。 可以在**异常情况检测**类别中找到此模块。

2. 在 "**基于 PCA 的异常检测**" 模块的 "**属性**" 窗格中，单击 "**定型模式**" 选项，并指定是要使用一组特定参数训练模型，还是使用参数扫描来查找最佳参数。

    - **单个参数**：如果你知道想要如何配置模型，并提供一组特定值作为参数，请选择此选项。

3. **要在 PCA 中使用的组件数**：指定要输出的输出功能或组件的数目。

    决定要包含多少个组件是使用 PCA 进行试验设计的重要组成部分。 一般指导原则是，不应包含与变量相同的 PCA 组件数。 相反，你应该从几个较小的组件开始，并将其增大到满足某些条件。

    当输出组件的数目**小于**数据集中可用的功能列数时，将获取最佳结果。

4. 指定在随机化 PCA 定型期间要执行的过度抽样量。 在异常情况检测问题中，不均衡数据使应用标准 PCA 方法变得困难。 通过指定一定数量的过度抽样，可以增加目标实例的数目。

    如果指定1，则不执行任何过度抽样。 如果指定任何大于1的值，则将生成用于定型模型的其他示例。

    有两个选项，具体取决于是否使用参数扫描：

    - **随机化 PCA 的过度抽样参数**：键入一个整数，该整数表示该少数类在普通类上的过度抽样的比率。 （使用**单参数**定型方法时可用。）

    > [!NOTE]
    > 不能查看过度数据集。 有关如何在 PCA 中使用过度抽样的更多详细信息，请参阅[技术说明](#technical-notes)。

5. **启用输入功能平均规范化**：选择此选项可将所有输入功能标准化为零平均值。 通常建议将规范化或缩放为零，因为 PCA 的目标是最大程度地提高变量之间的差异。

     默认情况下选择此选项。 如果已使用其他方法或小数位数对值进行规范化，请取消选择此选项。

6. 连接带标记的训练数据集和训练模块之一：

    - 如果将 "**创建训练人员模式**" 选项设置为 "**单个参数**"，请使用 "[训练异常检测模型](train-anomaly-detection-model.md)" 模块。

7. 运行管道。

## <a name="results"></a>结果

训练完成后，可以保存训练的模型，或将其连接到 "[评分模型](score-model.md)" 模块来预测异常分数。

若要评估异常情况检测模型的结果，需要执行一些附加步骤：

1. 确保两个数据集中都有评分列

    如果尝试评估异常情况检测模型并收到错误 "评分数据集中没有要比较的评分列"，则表示使用的是典型的包含标签列但没有概率分数的计算数据集。 你需要选择与异常情况检测模型的架构输出相匹配的数据集，其中包括**评分标签**和**评分概率**列。

2. 确保标签列已标记

    有时，与标签列关联的元数据将在管道图形中被删除。 如果发生这种情况，使用 "[评估模型](evaluate-model.md)" 模块来比较两个异常情况检测模型的结果时，可能会收到错误 "未评分的数据集中没有标签列"，或 "要比较的评分数据集中没有标签列"。

    可以通过在 "[评估模型](evaluate-model.md)" 模块之前添加 "[编辑元数据](edit-metadata.md)" 模块来避免此错误。 使用 "列选择器" 选择 "类" 列，然后在 "**字段**" 下拉列表中选择 "**标签**"。

3. 使用 "[执行 Python 脚本](execute-python-script.md)" 可将标签列类别调整为1（正、正常）和0（负、不正常）。

    ````
    label_column_name = 'XXX'
    anomaly_label_category = YY
    dataframe1[label_column_name] = dataframe1[label_column_name].apply(lambda x: 0 if x == anomaly_label_category else 1)
    ````

    
## <a name="technical-notes"></a>技术说明

此算法使用 PCA 来估算包含普通类的子空间。 子空间由与数据协方矩阵的顶部本征值关联的本征向量跨越。 对于每个新输入，异常探测器首先在本征向量上计算其投影，然后计算规范化的重构错误。 此错误是异常分数。 错误越高，实例的异常就越多。 有关如何计算正常空间的详细信息，请参阅维基百科：[主体组件分析](https://wikipedia.org/wiki/Principal_component_analysis) 


## <a name="next-steps"></a>后续步骤

查看可用于 Azure 机器学习[的模块集](module-reference.md)。 

有关特定于设计器模块的错误列表，请参阅[设计器（预览）的异常和错误代码](designer-error-codes.md)。