---
title: Azure Database for MySQL 灵活的服务器的区域冗余高可用性概述
description: 了解 Azure Database for MySQL 灵活的服务器的区域冗余高可用性的概念
author: kummanish
ms.author: manishku
ms.service: mysql
ms.topic: conceptual
ms.date: 09/21/2020
ms.openlocfilehash: 9db5776a4d2395baf03a5ed7cf05db49de8d0321
ms.sourcegitcommit: 53acd9895a4a395efa6d7cd41d7f78e392b9cfbe
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/22/2020
ms.locfileid: "90933360"
---
# <a name="high-availability-concepts-in-azure-database-for-mysql-flexible-server-preview"></a>Azure Database for MySQL 灵活的服务器 (预览版中的高可用性概念) 

> [!IMPORTANT] 
> Azure Database for MySQL 灵活服务器当前以公共预览版提供。

Azure Database for MySQL 灵活的服务器 (预览版) ，允许使用 **区域冗余** 高可用性选项通过自动故障转移来配置高可用性。 当部署在区域冗余配置中时，灵活的服务器会自动预配和管理不同可用性区域中的备用副本。 使用存储级复制，数据将 **同步复制** 到辅助区域中的备用服务器，以在故障转移后实现零数据丢失。 故障转移是从客户端应用程序完全透明的，无需任何用户操作。 备用服务器不适用于任何读取或写入操作，而是被动备用，可实现快速故障转移。 故障转移时间通常范围为60-120 秒。

区域冗余高可用性配置在计划事件（例如用户启动的规模计算操作）和计划外事件（例如基础硬件和软件故障、网络故障，甚至是可用性区域故障）期间启用自动故障转移。

:::image type="content" source="./media/concepts-high-availability/1-flexible-server-overview-zone-redundant-ha.png" alt-text="区域冗余高可用性的视图":::

## <a name="zone-redundancy-architecture"></a>区域冗余体系结构

主服务器部署在区域和特定的可用性区域中。 选择高可用性时，会自动部署与主服务器具有相同配置的备用副本服务器，包括计算层、计算大小、存储大小和网络配置。 日志数据以同步方式复制到备用副本，以确保在发生任何故障时不会丢失数据。 自动备份（快照和日志备份）是从主数据库服务器执行的。 

在 "概述" 页上持续监视和报告 HA 的运行状况。

下面列出了各种复制状态：

| **状态** | **说明** |
| :----- | :------ |
| <b>NotEnabled | 区域冗余 HA 未启用 |
| <b>CreatingStandby | 在创建新备用的过程中 |
| <b>ReplicatingData | 创建备用后，它会与主服务器保持运行。 |
| <b>FailingOver | 数据库服务器正在从主服务器故障转移到备用服务器。 |
| <b>正常 | 区域冗余 HA 处于稳定状态且正常。 |
| <b>RemovingStandby | 根据用户操作，备用副本将处于删除过程中。| 

## <a name="advantages"></a>优点

下面是使用区域冗余 HA 功能的一些优点： 

-   备用副本将部署在与主副本完全相同的 VM 配置中，如 Vcore、存储、网络设置 (VNET、防火墙) 等。
-   可以通过禁用高可用性来删除备用副本。
-   自动备份是基于快照的，它从主数据库服务器执行并存储在区域冗余存储中。
-   如果存在故障转移事件，则会在原始主可用性区域中预配新的备用副本。
-   客户端始终连接到主数据库服务器。
-   如果数据库崩溃或节点发生故障，则在同一节点上首先尝试重启。 如果此操作失败，则会触发自动故障转移。
-   能够重新启动服务器以获取任何静态服务器参数更改。

## <a name="steady-state-operations"></a>稳定状态操作

应用程序使用数据库服务器名称连接到主服务器。 不公开备用副本信息以进行直接访问。 仅在主服务器的磁盘和备用副本上以同步方式保留日志文件之后，才会向应用程序确认提交和写入。 由于这一额外的往返要求，应用程序可能会预计写入和提交的延迟。 可以在门户上监视高可用性的运行状况。

## <a name="failover-process"></a>故障转移过程 
对于业务连续性，需要为计划内和计划外事件提供故障转移过程。 

### <a name="planned-events"></a>计划事件

计划停机事件包括由 Azure 计划的活动，例如定期软件更新、次版本升级或由客户启动，如规模计算和规模存储操作。 所有这些更改将首先应用于备用副本。 在这段时间内，应用程序将继续访问主服务器。 更新备用副本后，主服务器连接将耗尽，并触发故障转移，通过更新 DNS 记录将备用副本激活为具有相同数据库服务器名称的主副本。 客户端连接将断开连接，它们将需要重新连接，并且可以恢复其操作。 新的备用服务器将与旧的主服务器建立在同一区域中。 总体故障转移时间应为60-120 秒。 

>[!NOTE]
> 在计算缩放操作的情况下，我们会缩放后跟主服务器的辅助副本服务器。 不涉及任何故障转移。

### <a name="failover-process---unplanned-events"></a>故障转移进程-计划外事件
计划外服务停机时间包括软件错误，或基础结构故障（如计算、网络、存储故障或电源中断）会影响数据库的可用性。 如果数据库不可用，则会断开到备用副本的复制，并激活备用副本作为主数据库。 DNS 经过更新，然后客户端重新连接到数据库服务器并恢复其操作。 总体故障转移时间应为60-120 秒。 不过，故障转移时，可能需要更长时间，具体取决于故障转移时主数据库服务器中的活动（如大型事务和恢复时间）。

## <a name="schedule-maintenance-window"></a>计划维护时段 

灵活的服务器提供维护计划功能，你可以在首选项中选择一个30分钟的时间段，在此期间，Azure 维护的工作方式（例如修补或次版本升级）。 对于配置了高可用性的灵活服务器，将首先在备用副本上执行这些维护活动。 

## <a name="point-in-time-restore"></a>时间点还原 
由于在高可用性中配置了灵活的服务器同步复制数据，因此备用服务器将与主服务器保持同步。 主站点上的任何用户错误（例如意外删除表或不正确的更新）都将切实复制到备用。 因此，不能使用备用恢复此类逻辑故障。 若要从这些逻辑错误中恢复，您必须执行时间点还原，直到发生错误。 使用灵活服务器的时间点还原功能，还原配置有高可用性的数据库时，将使用用户提供的名称将新的数据库服务器还原为新的灵活服务器。 然后，可以从数据库服务器中导出对象，并将其导入到生产数据库服务器。 同样，如果你想要克隆你的数据库服务器以便进行测试和开发，或者出于任何其他目的要还原，你可以选择最新的还原点或自定义的还原点。 还原操作将创建单个区域的灵活服务器。

## <a name="mitigate-downtime"></a>减少停机时间 
如果使用的不是区域冗余 HA 功能，则需要仍能降低应用程序的停机时间。 规划服务停机时间（如计划的修补程序、次版本升级或用户启动的操作）可以作为计划维护时段的一部分执行。 计划的服务停机时间（如计划的修补程序、次版本升级或用户启动的操作，如规模计算）会导致停机。 若要减轻 Azure 启动的维护任务对应用程序的影响，可以选择在一周中的某一天以及对应用程序的影响最小的时间进行计划。 

在计划外停机事件（例如数据库崩溃或服务器故障）期间，将在同一区域内重新启动受影响的服务器。 虽然很少见，如果整个区域受到影响，您可以在区域内的另一个区域中还原数据库。 

## <a name="things-to-know-with-zone-redundancy"></a>有关区域冗余的注意事项 

使用区域冗余高可用性时，请注意以下几个注意事项： 

-   只有在创建灵活的服务器时 **才** 可以设置高可用性。
-   可突增计算层不支持高可用性。
-   由于同步复制到另一个可用性区域，主数据库服务器可能会遇到提升的写入和提交延迟。
-   备用副本不能用于只读查询。
-   故障转移时，可能需要长达60-120 秒钟或更长时间，才能完成故障转移。
-   重新启动主数据库服务器以选取静态参数更改也会重启备用副本。
-   不支持为区域冗余高可用性服务器配置读取副本。
-   在托管维护时段无法自动配置客户启动的管理任务。
-   计划事件（例如缩放计算和次版本升级）同时发生在主和备用中。 


## <a name="next-steps"></a>后续步骤

-   了解 [业务连续性](./concepts-business-continuity.md)
-   了解 [区域冗余高可用性](./concepts-high-availability.md)
-   了解 [备份和恢复](./concepts-backup-restore.md)
