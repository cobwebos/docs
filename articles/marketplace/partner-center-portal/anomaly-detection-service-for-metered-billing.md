---
title: 按流量计费 Microsoft Azure 市场的异常情况检测服务
description: 介绍异常检测的工作原理、发送通知的方式以及如何处理通知以及支持选项。
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: conceptual
author: anbene
ms.author: mingshen
ms.date: 06/10/2020
ms.openlocfilehash: becd15ceea41e40b35848f46f9657c501acf659a
ms.sourcegitcommit: d7008edadc9993df960817ad4c5521efa69ffa9f
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/08/2020
ms.locfileid: "86122024"
---
# <a name="anomaly-detection-service-for-metered-billing"></a>按流量计费的异常情况检测服务

[Marketplace 计量服务](marketplace-metering-service-apis-faq.md)使你可以在基于非标准单位收费的商业市场计划中创建产品/服务。 通过计费计费，你可以将客户使用情况事件发送到 Microsoft，并根据该使用情况准备计费。

错误的使用情况数据可能来自多种原因，例如 bug、消耗跟踪中的错误配置或欺诈行为。 使用情况数据不正确会导致客户费用和计费争议不正确。

为了缓解此风险，我们的异常情况检测服务会应用机器学习算法来确定正常的按流量计费行为，分析按流量计费的使用情况，并使用最少的用户干预发现异常。

如果在按流量计费的使用情况中检测到异常，则会通知你。 这使您有机会调查并通知我们是否已确认异常是一个真正的问题，在这种情况下，可以采取相应措施来提前解决客户的计费问题。

除了突然出现的峰值、dip 和趋势变化的计费使用情况外，我们的模型还会使季节性效应。 由于计量计费通过超额数据进行通信，因此，模型还能够正常处理丢失数据的长时间。

下面是异常检测结果的示例。 预期范围显示为黄色带区。 可接受的按流量计费使用情况在带区显示为绿色星。 带区外的计费使用情况以红点显示。  

检测到可预测趋势以外的异常：

![说明在可预测趋势以外检测到的异常。](media/anomaly-1.png)

在重复循环趋势以外检测到的异常：

![说明在重复循环趋势以外检测到的异常。](media/anomaly-2.png)

在向上趋势中检测到异常：

![说明在向上趋势中检测到的异常。](media/anomaly-3.png)

## <a name="how-anomaly-detection-service-works"></a>异常情况检测服务的工作原理

自动为所有按流量计费使用启用异常情况检测。 向 Microsoft 提交使用情况事件时，异常情况检测服务会根据过去的使用情况数据创建预期值的模型。 此模型每周运行一次。

异常情况检测功能针对每个计量和每个客户的级别。 这意味着每个客户的每个计量器都有一个基于此指标的客户过去使用模式训练的模型。

此模型的工作原理是生成追溯置信区间。 时序预测是一种通用化的附加模型，由趋势预测部分和季节性部分组成。 由于模型被表述为回归任务，因此它可以合理地处理丢失数据的长时间。 如果观察范围超出了预测的置信区间，则表示无法根据按流量计费的历史模式来说明观察，因此可能是异常情况。

## <a name="anomaly-detection-notification"></a>异常情况检测通知

我们每周会对异常检测通知发送电子邮件。 它包括所有计量和客户在一周内检测到的所有异常。 此电子邮件将发送给你创建产品/服务时提供的**工程**和**支持**联系人。

应调查检测到的异常是否是真正的问题，如果是，请联系 Microsoft 报告错误的使用情况（请参阅下面的 "支持" 部分）。

如果确认检测到的异常正常使用，则无需执行任何其他操作。 但是，如果异常表示潜在的高财务风险，我们可能会与你联系以确认使用情况。  

## <a name="when-and-how-to-get-support"></a>何时以及如何获取支持

如果你将错误的使用情况发送到 Microsoft，或将导致客户 undercharge，Microsoft 将不会在报告的使用情况下向客户发起帐单或为该使用付费。 由于正在报告下，你将必须承担收入损失。

如果下列情况之一适用，则可以打开支持票证，为客户请求退款或计费调整：

- 您确认我们发现的异常之一是真正的问题，不正确的用法会导致客户**overcharge** 。
- 你发现你向我们发送了错误的使用情况，并且错误的用法会导致客户**overcharge** 。
- 你需要为客户的按流量计费用量请求退款。

提交票证：

1. 转到支持页。 在 "**告诉我们你的问题" 框**中，输入 "错误的使用情况"。
2. 在 "支持" 主题的 "搜索结果" 下拉范围内，选择下列项之一：
    - **商业应用商店**  > 计费**计费**  > **为 Azure 应用程序提供了错误的使用情况**，或
    - **商业应用商店**  > 计费**计费**  > **为 SaaS 产品发送了错误的使用情况**
3. 在 "**下一步**" 下，选择 "**检查解决方案**" 按钮，将其定向到 "合作伙伴中心" 以提交支持票证。

有关发布者支持选项的详细信息，请参阅[合作伙伴中心的商业市场计划支持](support.md)。

## <a name="next-step"></a>后续步骤

- 了解[Marketplace 计量服务 API](marketplace-metering-service-apis.md)。
