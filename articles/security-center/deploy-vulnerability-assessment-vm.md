---
title: 适用于 Azure 和混合计算机的安全中心集成漏洞评估解决方案
description: 在 Azure 计算机上安装漏洞评估解决方案，以便在 Azure 安全中心获取可帮助你保护 Azure 和虚拟机的建议
services: security-center
documentationcenter: na
author: memildin
manager: rkarlin
ms.service: security-center
ms.devlang: na
ms.topic: how-to
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 10/13/2020
ms.author: memildin
ms.openlocfilehash: 803c2b4ef335997a2dc24edf7812d7526f70c421
ms.sourcegitcommit: 2c586a0fbec6968205f3dc2af20e89e01f1b74b5
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/14/2020
ms.locfileid: "92015594"
---
# <a name="azure-defenders-integrated-vulnerability-assessment-solution-for-azure-and-hybrid-machines"></a>Azure 和混合计算机的 azure Defender 集成漏洞评估解决方案

每个网络风险和安全计划的核心部分都是识别和分析漏洞。 

安全中心会定期检查连接的计算机，以确保它们正在运行漏洞评估工具。

当发现某个计算机未部署漏洞评估解决方案时，安全中心将生成以下安全建议：

**应在虚拟机上启用漏洞评估解决方案**

使用此建议将漏洞评估解决方案部署到 Azure 虚拟机和启用了 Azure Arc 的混合计算机。

部署最符合您的需求和预算的漏洞评估解决方案：

- ** (通过 Qualys) 支持集成漏洞评估解决方案 ** -Azure Defender 包括计算机的漏洞扫描，无需额外付费。 你无需具备 Qualys 许可证，甚至还不需要 Qualys 帐户 - 所有操作都在安全中心内无缝执行。 本页提供有关此扫描程序的详细信息，以及有关如何部署它的说明。

    > [!TIP]
    > 集成漏洞评估解决方案支持 Azure 虚拟机和混合计算机。 若要将漏洞评估扫描器部署到本地和多云计算机，请先将其连接到 azure Arc，如 [将非 Azure 计算机连接到安全中心](quickstart-onboard-machines.md)中所述。
    >
    > 安全中心的集成漏洞评估解决方案可与 Azure Arc 无缝配合使用。部署 Azure Arc 后，计算机将显示在 "安全中心" 中，无需 Log Analytics 代理。

- **自带许可证 (BYOL) 解决方案** -安全中心支持其他供应商提供的工具集成，但你需要处理许可成本、部署和配置。 通过使用安全中心部署工具，你将获得有关哪些 Azure 虚拟机缺少该工具的信息。 你还可以在安全中心内查看发现。 如果希望使用组织的私有 Qualys 或 Rapid7 许可证，而不是 Azure Defender 随附的 Qualys 许可证，请参阅 [如何部署 BYOL 解决方案](deploy-vulnerability-assessment-byol-vm.md)。


## <a name="availability"></a>可用性

|方面|详细信息|
|----|:----|
|发布状态：|正式发布 (GA)|
|) 的混合方案 (计算机类型：|![是](./media/icons/yes-icon.png) Azure 虚拟机<br>![是](./media/icons/yes-icon.png)  (预览版的支持 Azure Arc 的计算机) |
|定价：|需要[用于服务器的 Azure Defender](defender-for-servers-introduction.md)|
|所需角色和权限：|**资源所有者** 可以部署扫描程序<br>**安全读者** 可以查看发现|
|云：|![是](./media/icons/yes-icon.png) 商业云<br>![否](./media/icons/no-icon.png) 国家/主权（US Gov、中国 Gov、其他 Gov）|
|||

## <a name="overview-of-the-integrated-vulnerability-scanner"></a>集成的漏洞扫描程序概述

Azure 安全中心随附的漏洞扫描程序由 Qualys 提供支持。 Qualys 的扫描程序是一种用于实时识别漏洞的领先工具。 它仅适用于适用 [于服务器的 Azure Defender](defender-for-servers-introduction.md)。 你无需具备 Qualys 许可证，甚至还不需要 Qualys 帐户 - 所有操作都在安全中心内无缝执行。

### <a name="how-the-integrated-vulnerability-scanner-works"></a>集成漏洞扫描程序的工作原理

漏洞扫描程序扩展的工作如下：

1. **部署** -Azure 安全中心监视你的计算机，并提供在所选计算机上部署 Qualys 扩展的建议。

1. **收集信息** - 扩展会收集定义区域中的项目，并将它们发送到 Qualys 云服务中进行分析。

1. Qualys**的云**服务执行漏洞评估，并将其结果发送到安全中心。 

    > [!IMPORTANT]
    > 为了确保客户的隐私、机密性和安全性，我们不与 Qualys 共享客户详细信息。 [详细了解 Azure 中内置的隐私标准](https://www.microsoft.com/trust-center/privacy)。

1. **报表** -安全中心提供的结果。

[![Azure 安全中心内置的漏洞扫描程序的流程图](media/built-in-vulnerability-assessment/va-vm-flow-diagram.png)](media/built-in-vulnerability-assessment/va-vm-flow-diagram.png#lightbox)


## <a name="deploy-the-integrated-scanner-to-your-azure-and-hybrid-machines"></a>将集成的扫描仪部署到 Azure 和混合计算机

1. 在 [Azure 门户](https://azure.microsoft.com/features/azure-portal/)中，打开“安全中心”。

1. 在安全中心的菜单中，打开 " **建议** " 页。

1. 选择建议在 **虚拟机上启用漏洞评估解决方案**。

    :::image type="content" source="./media/deploy-vulnerability-assessment-vm/recommendation-page-machine-groupings.png" alt-text="建议页中的计算机分组" lightbox="./media/deploy-vulnerability-assessment-vm/recommendation-page-machine-groupings.png":::

    > [!TIP]
    > 上面的计算机 "server16" 是启用了 Azure Arc 的计算机。 若要将漏洞评估扫描器部署到本地和多云计算机，请参阅 [将非 Azure 计算机连接到安全中心](quickstart-onboard-machines.md)。
    >
    > 安全中心可与 Azure Arc 无缝配合使用。部署 Azure Arc 后，计算机将显示在 "安全中心" 中，无需 Log Analytics 代理。

    你的计算机将显示在以下一个或多个组中：

    * **正常资源** –安全中心检测到在这些计算机上运行的漏洞评估解决方案。
    * 不**正常资源**–可以将漏洞扫描程序扩展部署到这些计算机。 
    * **不适用的资源** -这些计算机不能部署漏洞扫描程序扩展。 你的计算机可能在此选项卡中，因为它是 AKS 群集中的映像，它是虚拟机规模集的一部分，或者它未运行集成漏洞扫描程序支持的操作系统之一：

        | **供应商** | **OS** | **支持的版本** |
        |----|----|----|
        |Microsoft|Windows|All|
        |Red Hat|Enterprise Linux|5.4 +、6、7.0-7.8、8.0-8。1|
        |Red Hat|CentOS|5.4 +、6、7.0-7.7、8.0-8。1|
        |Red Hat|Fedora|22-31|
        |SUSE|Linux Enterprise Server (SLES)|11、12、15|
        |SUSE|OpenSUSE|12、13、15。0|
        |SUSE|Leap|42.1|
        |Oracle|Enterprise Linux|5.11、6、7.0-7.5|
        |Debian|Debian|7. x-10. x|
        |Ubuntu|Ubuntu|12.04 LTS，14.04 LTS，，16.04 LTS，18.04 LTS，19.10，20.04 LTS|

1. 在不正常的计算机列表中，选择要接收漏洞评估解决方案的计算机，然后选择 " **更正**"。

    >[!IMPORTANT]
    > 根据你的配置，此列表可能以不同方式出现。 
    >
    > - 如果尚未配置第三方漏洞扫描程序，则无法进行部署。
    > - 如果所选计算机未受到 Azure Defender 的保护，则 "ASC 集成漏洞扫描程序" 选项将不可用。

    :::image type="content" source="./media/deploy-vulnerability-assessment-vm/recommendation-remediation-options.png" alt-text="建议页中的计算机分组" **更正**"。

    在几分钟内会在所有选定的计算机上安装 scanner 扩展。
    
    在成功部署扩展后，扫描就会自动开始进行。 随后，扫描将按四小时的间隔时间运行。 此时间间隔不可配置。

    >[!IMPORTANT]
    > 如果在一台或多台计算机上部署失败，请确保目标计算机可以通过端口 443 (以下两个 IP 地址与 Qualys 的云服务进行通信-HTTPS) 的默认值：
    >
    >   - 64.39.104.113-Qualys ' US 数据中心
    >   - 154.59.121.74-Qualys ' 欧洲数据中心
    >
    > 如果你的计算机处于欧洲 Azure 区域，则其项目将在 Qualys 的欧洲数据中心处理。 位于其他位置的虚拟机的项目将发送到 US 数据中心。


## <a name="automate-at-scale-deployments"></a>自动执行大规模部署

> [!NOTE]
> 本部分所述的所有工具都可以从 [安全中心的 GitHub 社区存储库](https://github.com/Azure/Azure-Security-Center/blob/master/README.md)获取。 在这里，可以找到要在 ASC 部署中使用的脚本、自动化和其他有用资源。
>
> 其中一些工具只会影响在启用大规模部署后连接的新计算机。 其他人还会部署到现有计算机。 可以组合多种方法。

可以通过多种方式自动部署集成扫描程序：

- **Azure 资源管理器** –此方法可从 Azure 门户中的 " **查看" 建议逻辑** 获得。 修正脚本包含可用于自动化的相关 ARM 模板： :::image type="content" source="./media/deploy-vulnerability-assessment-vm/deploy-at-scale-remediation-logic.png" alt-text="建议页中的计算机分组" lightbox="./media/deploy-vulnerability-assessment-vm/deploy-at-scale-remediation-logic.png":::
- **DeployIfNotExists 策略** -一种用于确保所有新创建的计算机都接收扫描程序的 [自定义策略](https://github.com/Azure/Azure-Security-Center/tree/master/Remediation%20scripts/Enable%20the%20built-in%20vulnerability%20assessment%20solution%20on%20virtual%20machines%20(powered%20by%20Qualys)/Azure%20Policy) 。 选择 " **部署到 Azure** " 并设置相关参数。 你可以在资源组、订阅或管理组级别分配此策略。
- **PowerShell 脚本** –使用 ```Update qualys-remediate-unhealthy-vms.ps1``` 脚本为所有不正常的虚拟机部署扩展。 若要在新资源上安装，请在 [Azure 自动化](https://docs.microsoft.com/azure/automation/automation-intro)中自动执行该脚本。 此脚本将查找建议发现的所有不正常的计算机并执行 Azure 资源管理器调用。
- **Azure 逻辑应用** -基于 [示例应用](https://github.com/Azure/Azure-Security-Center/tree/master/Workflow%20automation/Install-VulnAssesmentAgent)构建逻辑应用。 使用安全中心的 [工作流自动化](workflow-automation.md) 工具触发逻辑应用，只要在 **虚拟机上启用了漏洞评估解决方案** ，就会为资源生成建议。
- **REST API** –若要部署使用安全中心 REST API 的集成漏洞评估解决方案，请向以下 URL 发出 PUT 请求并添加相关资源 ID： ```https://management.azure.com/<resourceId>/providers/Microsoft.Security/serverVulnerabilityAssessments/default?api-Version=2015-06-01-preview```



## <a name="trigger-an-on-demand-scan"></a>触发按需扫描

可以使用本地或远程执行的脚本或 GPO，从计算机本身触发按需扫描。 或者，你可以在修补程序部署作业结束时将其集成到你的软件分发工具。 

以下命令触发按需扫描：

- **Windows 计算机**： ```REG ADD HKLM\SOFTWARE\Qualys\QualysAgent\ScanOnDemand\Vulnerability /v "ScanOnDemand" /t REG_DWORD /d "1" /f```
- **Linux 计算机**： ```sudo /usr/local/qualys/cloud-agent/bin/cloudagentctl.sh action=demand type=vm```

## <a name="faq---integrated-vulnerability-scanner-powered-by-qualys"></a>常见问题解答-Qualys) 支持的集成漏洞扫描器 (

### <a name="are-there-any-additional-charges-for-the-qualys-license"></a>使用 Qualys 许可证是否需要支付额外费用？
否。 内置扫描程序可供所有 Azure Defender 用户免费。 建议会部署扫描程序及其授权和配置信息。 无需任何其他许可证。 

### <a name="what-prerequisites-and-permissions-are-required-to-install-the-qualys-extension"></a>安装 Qualys 扩展需要哪些先决条件和权限？
对于要在其上部署扩展的任何计算机，你都需要具有写入权限。

与其他扩展一样，Azure 安全中心漏洞评估扩展（由 Qualys 提供支持）将在 Azure 虚拟机代理之上运行。 因此，它将作为 Windows 上的本地主机和 Linux 上的根运行。

在安装过程中，安全中心将进行检查以确保计算机可以通过端口 443 (与以下两个 Qualys 的数据中心进行通信-HTTPS) 的默认值：

- 64.39.104.113-Qualys ' US 数据中心
- 154.59.121.74-Qualys ' 欧洲数据中心

此扩展当前不接受任何代理配置详细信息。

### <a name="can-i-remove-the-security-center-qualys-extension"></a>是否可以删除安全中心 Qualys 扩展？ 
如果要从计算机中删除该扩展，可以手动或使用任何编程工具来执行此操作。 

你将需要以下详细信息：

* 在 Linux 上，该扩展名为 "LinuxAgent. AzureSecurityCenter"，发布者名称为 "Qualys"
* 在 Windows 上，该扩展名为 "WindowsAgent. AzureSecurityCenter"，提供程序名称为 "Qualys"

### <a name="how-does-the-extension-get-updated"></a>扩展是如何更新的？
与 Azure 安全中心代理本身以及其他所有 Azure 扩展一样，Qualys 扫描程序的次要更新可能会在后台自动发生。 所有代理和扩展在自动被部署前都会经过广泛的测试。

### <a name="why-does-my-machine-show-as-not-applicable-in-the-recommendation"></a>为什么我的计算机在建议中显示为 "不适用"？
"建议详细信息" 页将计算机分为以下列表： " **正常**"、"不 **正常**" 和 " **不适用**"。

如果计算机位于 " **不适用** 的资源" 组中，则表示安全中心无法在这些计算机上部署漏洞扫描程序扩展。

您的计算机可能在此选项卡中，原因如下：

- 它不受 Azure Defender 的保护-如上所述，Azure 安全中心随附的漏洞扫描器仅适用于由 [Azure Defender 为服务器](defender-for-servers-introduction.md)保护的计算机。

- 它是 AKS 群集或虚拟机规模集的一部分的映像-此扩展不支持作为 PaaS 资源的虚拟机。

- 它未运行受支持的操作系统之一：

    | **供应商** | **OS** | **支持的版本** |
    |----|----|----|
    |Microsoft|Windows|All|
    |Red Hat|Enterprise Linux|5.4 +、6、7.0-7.8、8.0-8。1|
    |Red Hat|CentOS|5.4 +、6、7.0-7.7、8.0-8。1|
    |Red Hat|Fedora|22-31|
    |SUSE|Linux Enterprise Server (SLES)|11、12、15|
    |SUSE|OpenSUSE|12、13、15。0|
    |SUSE|Leap|42.1|
    |Oracle|Enterprise Linux|5.11、6、7.0-7.5|
    |Debian|Debian|7. x-10. x|
    |Ubuntu|Ubuntu|12.04 LTS，14.04 LTS，，16.04 LTS，18.04 LTS，19.10，20.04 LTS|
    ||||

### <a name="what-is-scanned-by-the-built-in-vulnerability-scanner"></a>内置的漏洞扫描程序会扫描哪些内容？
扫描程序在计算机上运行以查找计算机本身的漏洞。 不能从计算机上扫描网络。

### <a name="does-the-scanner-integrate-with-my-existing-qualys-console"></a>此扫描程序与我现有的 Qualys 控制台相集成了吗？
安全中心扩展是独立于你现有 Qualys 扫描程序的一个工具。 许可限制意味着它只能在 Azure 安全中心内使用。

### <a name="microsoft-defender-advanced-threat-protection-also-includes-threat--vulnerability-management-tvm-how-is-the-security-center-vulnerability-assessment-extension-different"></a>Microsoft Defender 高级威胁防护还包含了威胁和漏洞管理 (TVM)。 安全中心漏洞评估扩展的不同之处是什么？
我们正在积极地使用 Windows 中内置的 Microsoft Defender ATP 威胁 & 漏洞管理解决方案来开发世界级漏洞管理服务。

现在，Azure 安全中心的漏洞评估扩展由 Qualys 提供支持。 Qualys 扩展可确保对 Windows 和 Linux 计算机的支持。 此扩展还可以从 Qualys 自身对没有 CVE 的漏洞的了解中获益。

### <a name="how-quickly-will-the-scanner-identify-newly-disclosed-critical-vulnerabilities"></a>扫描程序识别新泄露的严重漏洞的速度有多快？
在48小时内泄露关键漏洞后，Qualys 会将信息合并到其处理中，并识别受影响的计算机。



## <a name="next-steps"></a>后续步骤

> [!div class="nextstepaction"]
> [修正漏洞评估解决方案中的发现](remediate-vulnerability-findings-vm.md)


安全中心还为以下内容提供漏洞分析：

- SQL 数据库 - 请参阅[在漏洞评估仪表板中浏览漏洞评估报告](defender-for-sql-usage.md#explore-vulnerability-assessment-reports)
- Azure 容器注册表映像-请参阅 [使用 Azure Defender 容器注册表扫描映像中的漏洞](defender-for-container-registries-usage.md)
